## 섹션 6. 다양한 연관관계 매핑

- 연관관계 매핑 시 고려사항 3가지: 다중성, 단방향/양방향, 연관관계의 주인

#### **다중성**

    - 다대일 `@ManyToOne`
    - 일대다 `@OneToMany`
    - 일대일 `@OneToOne`
    - 다대다 `@ManyToMany`

- tip: 애매할 땐 반대쪽을 생각해보기 (대칭성)
  - ex. 회원과 팀, 팀과 회원의 관계

#### **단방향/양방향**

- 테이블은 외래키 하나로 양쪽 조인 가능, 방향이라는 개념이 없음
- 객체는 참조용 필드가 있는 쪽으로만 참조 가능, 양방향의 경우 사실은 2개의 단방향

#### **연관관계의 주인 (양방향일 때)**

- 테이블은 외래키 하나로 연관관계
- 객체는 참조가 두군데
  - 둘 중 하나는 외래키를 관리해야 -> 그래서 나온 게 연관관계의 주인(=외래키를 관리하는 참조)
  - 주인의 반대편은 단순 조회만 가능

### 다대일 [N:1]

#### **다대일 단방향**

![image](https://user-images.githubusercontent.com/57944099/168225845-a3a9f952-399f-4c6f-a385-50de0fa4f694.png)

- 가장 많이 사용하는 형태, 반대는 1:N

#### **다대일 양방향**

![image](https://user-images.githubusercontent.com/57944099/168226280-310d7840-eadf-4f6a-8b78-da2dba58272d.png)

- 양쪽을 서로 참조하도록 개발
  - 다른 엔티티 클래스(Team)에 참조 추가하기

### 일대다 [1:N]

#### **일대다 단방향**

![image](https://user-images.githubusercontent.com/57944099/168227148-7fc671e3-6ff4-4731-aa40-31a9e7c0dcf4.png)

- 객체의 1:N 관계에서 1이 연관관계의 주인
- 테이블의 1:N 관계에서는 N쪽에 외래키 존재
- 단점:
  1. 엔티티가 관리하는 외래키가 다른 테이블에 존재한다
  2. 연관관계 관리를 위해 추가로 UPDATE SQL 실행
- 권장: 일대다 단방향 매핑 <<<<< **다대일 양방향 매핑** (객체지향적으로 trade-off 존재하더라도)

#### **일대다 양방향**

![image](https://user-images.githubusercontent.com/57944099/168228471-e97bb2ef-58f3-41e5-b757-04f07b87fa1c.png)

- 공식적으로 존재하지 않는 매핑 방식
- 읽기 전용 필드로 야매스럽게 구현은 할 수 있음
- `@JoinColumn(name="TEAM_ID, insertable=false, updatable=false)`
- 결론: 다대일 양방향을 사용하라

### 일대일 [1:1]

- 반대도 일대일
- 주 테이블 or 대상 테이블 중 외래키 선택 가능
- 외래키에 unique 제약 조건 추가하기

#### **일대일: 주 테이블에 외래키 단방향**

![image](https://user-images.githubusercontent.com/57944099/168229684-58fab3bc-42c7-4a6a-b8af-a319a4084603.png)

- 다대일(N:1) 단방향 매핑과 유사

#### **일대일: 주 테이블에 외래키 양방향**

![image](https://user-images.githubusercontent.com/57944099/168229995-5d1080bc-b0f9-4195-9b4d-b84236e42ee6.png)

- 다대일 양방향 매핑 처럼 외래 키가 있는 곳이 연관관계의 주인, 반대편은 mappedBy 적용

#### **일대일: 대상 테이블에 외래키 단방향**

![image](https://user-images.githubusercontent.com/57944099/168230787-07243864-ba99-4499-a632-8f1204166738.png)

- 단방향 관계는 지원되지 않고, 양방향 관계는 지원

#### **일대일: 대상 테이블에 외래키 양방향**

![image](https://user-images.githubusercontent.com/57944099/168231097-508b8bbe-1e90-44d3-b6f9-e435ad188923.png)

#### **일대일 정리**

- 주 테이블에 외래키 (개발자 선호) vs. 대상 테이블에 외래키 (DBA 선호)
- trade-off 존재, 협의가 필요한 부분이다

### 다대다 [N:M]

![image](https://user-images.githubusercontent.com/57944099/168233283-eebebfdd-52c4-4197-be05-9b654004f721.png)

- 관계형 DB는 테이블 2개로 다대다 관계 표현 불가 -> 연결 테이블을 추가해서 일대다, 다대일 관계로 풀어내야
- 객체는 객체 2개로 다대다 구현 가능 (컬렉션 활용)

#### **다대다 구현하기**

- `@ManyToMany`
- `@JoinTable`로 연결 테이블 지정

#### **다대다 매핑의 한계**

- **편리해 보이지만 실무에서 사용X**
- 연결 테이블에 매핑 정보만 들어가고 다른 추가 정보를 넣을 수 없다는 단점

#### **다대다 한계 극복**

![image](https://user-images.githubusercontent.com/57944099/168233484-1e5b3a51-d9be-438b-baf4-bffe52befb6d.png)

- 연결 테이블용 엔티티 추가 - 연결 테이블을 엔티티로 승격
- `@ManyToOne` -> `@OneToMany` + `@ManyToOne`

## 섹션 7. 고급 매핑

### 상속관계 매핑

### Mapped Superclass - 매핑 정보 상속
