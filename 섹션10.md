## 객체지향 쿼리 언어1 - 기본 문법

### 소개

#### **JPA는 다양한 쿼리 방법을 지원한다**

- JPQL
- JPA Criteria
- QueryDSL
- 네이티브 SQL
- Jdbc API 직접 사용, MyBatis, SpringJdbcTemplate과 함께 사용

#### **JPQL(Java Persistence Query Language) 소개**

- 검색 조건이 포함된 SQL이 필요 (ex. 나이가 18세 이상인 회원 검색)
- **JPQL : SQL을 추상화한 객체지향 쿼리 언어**
- SQL 문법과 유사 (SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 지원)
- 엔티티 객체 대상 쿼리(JPQL) vs. 데이터베이스 테이블 대상 쿼리(SQL)

```java
String jpql = "select m from Member m where m.name like '%hello%'";
List<Member> result = em.createQuery(jpql, Member.class).getResultList();
```

👉 테이블이 아닌 객체 대상 검색 (여기서 m은 Member 엔티티를 가리킴)

- 단점: 동적 쿼리하기 힘듦 -> JPA Criteria, QueryDSL (자바 코드로 짜서 JPQL을 빌드해주는 generator라고 함)

#### **Criteria 소개**

- 단점: 너무 복잡하고 실용성이 없다
- Criteria <<<<< QueryDSL
  - 공통점: 문자가 아닌 자바 코드로 JPQL 작성 가능, JPQL 빌더 역할, 동적쿼리 작성 가능

<details>
<summary>코드 참고</summary>
<div markdown="1">
<code>
CriteriaBuilder cb = em.getCriteriaBuilder();<br> 
CriteriaQuery&lt;Member&gt; query = cb.createQuery(Member.class);<br>
Root&lt;Member&gt m = query.from(Member.class);<br>
CriteriaQuery&lt;Member&gt cq =  query.select(m).where(cb.equal(m.get("username"), “kim”));<br>
List&lt;Member&gt resultList = em.createQuery(cq).getResultList();
</code>
</div>
</details>

#### **QueryDSL 소개**

```java
//JPQL
//select m from Member m where m.age > 18
JPAFactoryQuery query = new JPAQueryFactory(em);
QMember m = QMember.member;

List<Member> list =
query.selectFrom(m)
        .where(m.age.get(18))
        .orderBy(m.name.desc())
        .fetch();
```

- 단순하고 쉽다는 장점 (-> 영한 님 왈; 모두 QueryDSL 하세요~~)

#### **네이티브SQL 소개**

- JPA가 제공하는 SQL을 직접 사용하는 개념(쌩쿼리)
- JPQL로 해결할 수 없는 특정 DB에 의존적인 기능 (ex. Oracle connect by)

```java
String sql = "SELECT ID, AGE, TEAM_ID, NAME FROM MEMBER WHERE NAME = ‘kim’";
List<Member> resultList = em.createNativeQuery(sql, Member.class).getResultList();
```

#### **JDBC 직접 사용, SpringJdbcTemplate**

- JPA를 사용하면서 JDBC 커넥션을 직접 사용하거나, 스프링 JdbcTemplate, 마이바티스등을 함께 사용 가능
- 주의) 영속성 컨텍스트를 적절한 시점에 강제로 플러시 필요

### 기본문법과 쿼리 API

### 프로젝션 (SELECT)

### 페이징

### 조인

### 서브쿼리

### JPQL 타입 표현식과 기타식

### 조건식 (CASE 등등)

### JPQL 함수
